PLACE_POPULATION2010_CSV <- '2010_interp_pop.csv'
PLACE_POPULATION2010_DF <- read.csv( file = PLACE_POPULATION2010_CSV,
stringsAsFactors = F )
month_to_int_converter <- function( x ){
int_mnths <- 1:12
suppressWarnings( int_x <- as.integer(x) )
if( int_x %in% int_mnths ) return( int_x )
is_substr <- function( sub_str, sup_str ){
length( grep(tolower(sub_str), tolower(sup_str)) ) > 0
}
if( is_substr('jan', x) ){
return( 1L )
} else if( is_substr('feb',x) ){
return( 2L )
} else if( is_substr('mar',x) ){
return( 3L )
} else if( is_substr('apr',x) ){
return( 4L )
} else if( is_substr('may',x) ){
return( 5L )
} else if( is_substr('jun',x) ){
return( 6L )
} else if( is_substr('jul',x) ){
return( 7L )
} else if( is_substr('aug',x) ){
return( 8L )
} else if( is_substr('sep',x) ){
return( 9L )
} else if( is_substr('oct',x) ){
return( 10L )
} else if( is_substr('nov',x) ){
return( 11L )
} else if( is_substr('dec',x) ){
return( 12L )
}
return( NA )
}
get_place_pop_df <- function( place_name,
state_abr,
pop_df ){
return( pop_df[ (pop_df$place_name == place_name) & (pop_df$state_abr == state_abr), ] )
}
format_monthly_hom_cnts <- function(
counts_csv_fp,
year_month_homcnt_cols,
pop_df,
hom_type_col = NULL,
use_home_types = NULL,
col_order = c('year',
'month',
'state_fips',
'state_abr',
'state_name',
'place_fips',
'place_name',
'within_county',
'population_est',
'homicide_count')
){
require( dplyr )
# read in and clean the monthly counts file passed
cnts_df <- read.csv( counts_csv_fp, stringsAsFactors = F )
if( !is.null(hom_type_col) & !is.null(use_hom_types) ){
cnts_df <- cnts_df[ sapply(cnts_df[hom_type_col], FUN = function(x){ x %in% use_hom_types}), ]
}
cnts_df <- cnts_df[year_month_homcnt_cols]
# standardize the col names for year, month, and counts
names(cnts_df) <- c('year','month','homicide_count')
# remove any NA homicide counts
cnts_df <- cnts_df[ !is.na(cnts_df$homicide_count), ]
# make sure the months are integers
cnts_df$month <- sapply( as.character(cnts_df$month), FUN = month_to_int_converter )
# group_by year and month and sum up counts (in case they were separated by homicide type)
cnts_df <- cnts_df %>% group_by( year, month ) %>% dplyr::summarise( homicide_count = sum(homicide_count) )
# join this with population data frame
ret_df <- merge( cnts_df, pop_df )
# finalize the orgainzation of the data
ret_df <- ret_df[col_order][order(ret_df$year, ret_df$month), ]
# remove index
rownames(ret_df) <- NULL
return( ret_df )
}
fp <- '~/Downloads/CPD_Crimes_2001_to_present_homicide_counts.csv'
df <- read.csv(fp,stringsAsFactors = F)
str(df)
year_month_homcnt_cols = c('year','month','count')
use_hom_types = 'FIRST DEGREE MURDER'
hom_type_col <- 'Description'
ret_df <- format_monthly_hom_cnts(fp,year_month_homcnt_cols,PLACE_POPULATION2010_DF, hom_type_col, use_hom_types )
glimpse(ret_df)
PLACE_POPULATION2010_Df
PLACE_POPULATION2010_DF
